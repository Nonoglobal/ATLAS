<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATLAS // GLOBAL NEWS MAP</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Share+Tech+Mono&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #000; color: #fff; font-family: 'Share Tech Mono', monospace; height: 100vh; overflow: hidden; }

        .scanlines { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: repeating-linear-gradient(0deg, rgba(0,0,0,0.1) 0px, rgba(0,0,0,0.1) 1px, transparent 1px, transparent 2px); pointer-events: none; z-index: 9999; }

        /* Header */
        .header { position: fixed; top: 0; left: 0; right: 0; height: 50px; background: rgba(0,0,0,0.95); border-bottom: 1px solid #1a1a1a; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; z-index: 1000; }
        .header-left { display: flex; align-items: center; gap: 20px; }
        .logo { font-family: 'Orbitron', sans-serif; font-size: 20px; font-weight: 900; letter-spacing: 5px; }
        .back-btn { padding: 8px 16px; background: none; border: 1px solid #333; color: #666; font-family: 'Share Tech Mono', monospace; font-size: 10px; letter-spacing: 2px; cursor: pointer; text-decoration: none; transition: all 0.3s; }
        .back-btn:hover { border-color: #fff; color: #fff; }
        .header-right { display: flex; align-items: center; gap: 15px; }
        .status-box { font-size: 10px; color: #666; letter-spacing: 2px; }
        .status-box span { color: #4ade80; }

        /* Map Container */
        #map { position: absolute; top: 50px; left: 0; right: 0; bottom: 0; background: #0a0a0f; z-index: 1; }

        /* Loading Screen */
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 2000; transition: opacity 0.5s; }
        .loading-overlay.hidden { opacity: 0; pointer-events: none; }
        .loading-logo { font-family: 'Orbitron', sans-serif; font-size: 48px; letter-spacing: 10px; margin-bottom: 10px; }
        .loading-subtitle { font-size: 10px; letter-spacing: 5px; color: #444; margin-bottom: 40px; }
        .loading-status { font-size: 11px; color: #666; margin-bottom: 20px; }
        .loading-bar { width: 300px; height: 2px; background: #1a1a1a; overflow: hidden; }
        .loading-fill { height: 100%; background: #fff; width: 0%; transition: width 0.3s; }

        /* Sidebar - Article List */
        .sidebar { position: fixed; top: 50px; right: 0; width: 380px; bottom: 0; background: rgba(0,0,0,0.95); border-left: 1px solid #1a1a1a; z-index: 500; display: flex; flex-direction: column; transition: transform 0.3s; }
        .sidebar.collapsed { transform: translateX(100%); }
        .sidebar-toggle { position: absolute; left: -40px; top: 50%; transform: translateY(-50%); width: 40px; height: 80px; background: rgba(0,0,0,0.9); border: 1px solid #1a1a1a; border-right: none; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 16px; color: #666; }
        .sidebar-toggle:hover { color: #fff; }
        
        .sidebar-header { padding: 20px; border-bottom: 1px solid #1a1a1a; }
        .sidebar-title { font-family: 'Orbitron', sans-serif; font-size: 12px; letter-spacing: 3px; margin-bottom: 10px; }
        .sidebar-stats { display: flex; gap: 20px; font-size: 10px; color: #666; }
        .sidebar-stats span { color: #fff; }
        
        .sidebar-search { padding: 15px 20px; border-bottom: 1px solid #1a1a1a; }
        .sidebar-search input { width: 100%; padding: 10px 15px; background: rgba(255,255,255,0.05); border: 1px solid #222; color: #fff; font-family: 'Share Tech Mono', monospace; font-size: 11px; }
        .sidebar-search input:focus { outline: none; border-color: #444; }
        .sidebar-search input::placeholder { color: #444; }
        
        .article-list { flex: 1; overflow-y: auto; padding: 10px; }
        .article-list::-webkit-scrollbar { width: 4px; }
        .article-list::-webkit-scrollbar-track { background: #0a0a0a; }
        .article-list::-webkit-scrollbar-thumb { background: #333; }

        .article-item { padding: 15px; background: rgba(255,255,255,0.02); border: 1px solid #1a1a1a; margin-bottom: 10px; cursor: pointer; transition: all 0.3s; }
        .article-item:hover { border-color: #333; background: rgba(255,255,255,0.05); }
        .article-item.active { border-color: #4ade80; background: rgba(74,222,128,0.1); }
        .article-item-source { font-size: 9px; color: #666; letter-spacing: 1px; margin-bottom: 5px; display: flex; justify-content: space-between; }
        .article-item-source .country-flag { }
        .article-item-title { font-size: 12px; line-height: 1.4; margin-bottom: 8px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .article-item-countries { display: flex; flex-wrap: wrap; gap: 5px; }
        .article-item-country { padding: 2px 6px; background: rgba(255,255,255,0.1); font-size: 8px; letter-spacing: 1px; }
        .article-item-country.primary { background: rgba(74,222,128,0.3); color: #4ade80; }

        /* Article Panel */
        .article-panel { position: fixed; bottom: 20px; left: 20px; width: 500px; max-height: 60vh; background: rgba(0,0,0,0.95); border: 1px solid #1a1a1a; z-index: 800; display: none; flex-direction: column; }
        .article-panel.show { display: flex; }
        .article-panel-header { padding: 15px 20px; border-bottom: 1px solid #1a1a1a; display: flex; justify-content: space-between; align-items: center; }
        .article-panel-title { font-family: 'Orbitron', sans-serif; font-size: 10px; letter-spacing: 2px; }
        .article-panel-close { background: none; border: none; color: #666; font-size: 20px; cursor: pointer; }
        .article-panel-close:hover { color: #fff; }
        
        .article-panel-content { padding: 20px; overflow-y: auto; flex: 1; }
        .article-panel-content::-webkit-scrollbar { width: 4px; }
        .article-panel-content::-webkit-scrollbar-thumb { background: #333; }
        
        .panel-source { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #1a1a1a; }
        .panel-source-icon { width: 32px; height: 32px; background: #1a1a1a; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .panel-source-info { flex: 1; }
        .panel-source-name { font-size: 10px; letter-spacing: 2px; }
        .panel-source-time { font-size: 9px; color: #666; }
        .panel-open-btn { padding: 8px 12px; background: #fff; color: #000; border: none; font-family: 'Orbitron', sans-serif; font-size: 8px; letter-spacing: 1px; cursor: pointer; }
        .panel-open-btn:hover { background: #ccc; }
        
        .panel-article-title { font-family: 'Merriweather', serif; font-size: 18px; line-height: 1.4; margin-bottom: 15px; }
        
        .panel-countries { margin-bottom: 15px; }
        .panel-countries-label { font-size: 9px; color: #666; letter-spacing: 2px; margin-bottom: 8px; }
        .panel-countries-list { display: flex; flex-wrap: wrap; gap: 8px; }
        .panel-country-tag { padding: 5px 10px; background: rgba(255,255,255,0.1); font-size: 10px; letter-spacing: 1px; display: flex; align-items: center; gap: 5px; }
        .panel-country-tag.primary { background: rgba(74,222,128,0.3); color: #4ade80; }
        .panel-country-tag .flag { font-size: 14px; }
        
        .panel-keywords { margin-top: 15px; padding-top: 15px; border-top: 1px solid #1a1a1a; }
        .panel-keywords-label { font-size: 9px; color: #666; letter-spacing: 2px; margin-bottom: 8px; }
        .panel-keywords-list { display: flex; flex-wrap: wrap; gap: 5px; }
        .panel-keyword { padding: 3px 8px; background: rgba(255,255,255,0.05); font-size: 9px; color: #888; }

        /* Country Info Tooltip */
        .country-tooltip { position: fixed; padding: 15px 20px; background: rgba(0,0,0,0.95); border: 1px solid #333; z-index: 1500; pointer-events: none; display: none; min-width: 200px; }
        .country-tooltip.show { display: block; }
        .country-tooltip-name { font-family: 'Orbitron', sans-serif; font-size: 14px; letter-spacing: 2px; margin-bottom: 5px; }
        .country-tooltip-count { font-size: 11px; color: #4ade80; }

        /* Map Styles */
        .leaflet-container { background: #0a0a0f !important; }
        .leaflet-control-zoom { display: none; }
        .leaflet-control-attribution { display: none; }

        /* Legend */
        .map-legend { position: fixed; bottom: 20px; right: 400px; background: rgba(0,0,0,0.9); border: 1px solid #1a1a1a; padding: 15px; z-index: 500; }
        .map-legend-title { font-family: 'Orbitron', sans-serif; font-size: 9px; letter-spacing: 2px; margin-bottom: 10px; color: #666; }
        .map-legend-item { display: flex; align-items: center; gap: 10px; margin-bottom: 5px; font-size: 10px; }
        .map-legend-color { width: 20px; height: 12px; }
        .sidebar.collapsed ~ .map-legend { right: 20px; }
    </style>
</head>
<body>
    <div class="scanlines"></div>

    <!-- Loading -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-logo">ATLAS</div>
        <div class="loading-subtitle">GLOBAL NEWS MAP</div>
        <div class="loading-status" id="loadingStatus">Initialisiere...</div>
        <div class="loading-bar"><div class="loading-fill" id="loadingFill"></div></div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <div class="logo">ATLAS</div>
            <a href="index.html" class="back-btn">‚Üê ZUR√úCK</a>
        </div>
        <div class="header-right">
            <div class="status-box">ARTIKEL: <span id="totalArticles">0</span></div>
            <div class="status-box">L√ÑNDER: <span id="totalCountries">0</span></div>
            <div class="status-box" id="currentTime">--:--:--</div>
        </div>
    </header>

    <!-- Map -->
    <div id="map"></div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-toggle" id="sidebarToggle">‚óÄ</div>
        <div class="sidebar-header">
            <div class="sidebar-title">LIVE NEWS FEED</div>
            <div class="sidebar-stats">
                <span id="filteredCount">0</span> Artikel
            </div>
        </div>
        <div class="sidebar-search">
            <input type="text" id="searchInput" placeholder="Suche nach Land, Thema, Keyword...">
        </div>
        <div class="article-list" id="articleList"></div>
    </div>

    <!-- Article Panel -->
    <div class="article-panel" id="articlePanel">
        <div class="article-panel-header">
            <div class="article-panel-title">ARTIKEL DETAILS</div>
            <button class="article-panel-close" id="panelClose">√ó</button>
        </div>
        <div class="article-panel-content" id="panelContent"></div>
    </div>

    <!-- Country Tooltip -->
    <div class="country-tooltip" id="countryTooltip">
        <div class="country-tooltip-name" id="tooltipName"></div>
        <div class="country-tooltip-count" id="tooltipCount"></div>
    </div>

    <!-- Legend -->
    <div class="map-legend">
        <div class="map-legend-title">ARTIKEL DICHTE</div>
        <div class="map-legend-item"><div class="map-legend-color" style="background: #1a472a;"></div> 1-2 Artikel</div>
        <div class="map-legend-item"><div class="map-legend-color" style="background: #2d6a4f;"></div> 3-5 Artikel</div>
        <div class="map-legend-item"><div class="map-legend-color" style="background: #40916c;"></div> 6-10 Artikel</div>
        <div class="map-legend-item"><div class="map-legend-color" style="background: #52b788;"></div> 11-20 Artikel</div>
        <div class="map-legend-item"><div class="map-legend-color" style="background: #74c69d;"></div> 20+ Artikel</div>
        <div class="map-legend-item"><div class="map-legend-color" style="background: #ff6b6b;"></div> Hervorgehoben</div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // ============ COUNTRY DATA ============
        const countryNames = {
            'AFG': { name: 'Afghanistan', code: 'AF', flag: 'üá¶üá´', keywords: ['afghanistan', 'kabul', 'taliban', 'afghan'] },
            'ALB': { name: 'Albanien', code: 'AL', flag: 'üá¶üá±', keywords: ['albania', 'albanien', 'tirana'] },
            'DZA': { name: 'Algerien', code: 'DZ', flag: 'üá©üáø', keywords: ['algeria', 'algerien', 'algier'] },
            'ARG': { name: 'Argentinien', code: 'AR', flag: 'üá¶üá∑', keywords: ['argentina', 'argentinien', 'buenos aires', 'milei'] },
            'ARM': { name: 'Armenien', code: 'AM', flag: 'üá¶üá≤', keywords: ['armenia', 'armenien', 'yerevan'] },
            'AUS': { name: 'Australien', code: 'AU', flag: 'üá¶üá∫', keywords: ['australia', 'australien', 'sydney', 'melbourne', 'canberra'] },
            'AUT': { name: '√ñsterreich', code: 'AT', flag: 'üá¶üáπ', keywords: ['austria', '√∂sterreich', 'wien', 'vienna', 'austrian'] },
            'AZE': { name: 'Aserbaidschan', code: 'AZ', flag: 'üá¶üáø', keywords: ['azerbaijan', 'aserbaidschan', 'baku'] },
            'BLR': { name: 'Belarus', code: 'BY', flag: 'üáßüáæ', keywords: ['belarus', 'wei√ürussland', 'minsk', 'lukashenko'] },
            'BEL': { name: 'Belgien', code: 'BE', flag: 'üáßüá™', keywords: ['belgium', 'belgien', 'br√ºssel', 'brussels'] },
            'BRA': { name: 'Brasilien', code: 'BR', flag: 'üáßüá∑', keywords: ['brazil', 'brasilien', 'brasilia', 'lula', 'bolsonaro'] },
            'BGR': { name: 'Bulgarien', code: 'BG', flag: 'üáßüá¨', keywords: ['bulgaria', 'bulgarien', 'sofia'] },
            'CAN': { name: 'Kanada', code: 'CA', flag: 'üá®üá¶', keywords: ['canada', 'kanada', 'ottawa', 'trudeau', 'canadian'] },
            'CHL': { name: 'Chile', code: 'CL', flag: 'üá®üá±', keywords: ['chile', 'santiago'] },
            'CHN': { name: 'China', code: 'CN', flag: 'üá®üá≥', keywords: ['china', 'beijing', 'peking', 'shanghai', 'xi jinping', 'chinese', 'taiwan'] },
            'COL': { name: 'Kolumbien', code: 'CO', flag: 'üá®üá¥', keywords: ['colombia', 'kolumbien', 'bogota'] },
            'HRV': { name: 'Kroatien', code: 'HR', flag: 'üá≠üá∑', keywords: ['croatia', 'kroatien', 'zagreb'] },
            'CUB': { name: 'Kuba', code: 'CU', flag: 'üá®üá∫', keywords: ['cuba', 'kuba', 'havana', 'havanna'] },
            'CYP': { name: 'Zypern', code: 'CY', flag: 'üá®üáæ', keywords: ['cyprus', 'zypern', 'nicosia'] },
            'CZE': { name: 'Tschechien', code: 'CZ', flag: 'üá®üáø', keywords: ['czech', 'tschechien', 'prague', 'prag'] },
            'DNK': { name: 'D√§nemark', code: 'DK', flag: 'üá©üá∞', keywords: ['denmark', 'd√§nemark', 'copenhagen', 'kopenhagen', 'greenland', 'gr√∂nland'] },
            'EGY': { name: '√Ñgypten', code: 'EG', flag: 'üá™üá¨', keywords: ['egypt', '√§gypten', 'cairo', 'kairo', 'suez'] },
            'EST': { name: 'Estland', code: 'EE', flag: 'üá™üá™', keywords: ['estonia', 'estland', 'tallinn'] },
            'ETH': { name: '√Ñthiopien', code: 'ET', flag: 'üá™üáπ', keywords: ['ethiopia', '√§thiopien', 'addis ababa'] },
            'FIN': { name: 'Finnland', code: 'FI', flag: 'üá´üáÆ', keywords: ['finland', 'finnland', 'helsinki'] },
            'FRA': { name: 'Frankreich', code: 'FR', flag: 'üá´üá∑', keywords: ['france', 'frankreich', 'paris', 'macron', 'french'] },
            'GEO': { name: 'Georgien', code: 'GE', flag: 'üá¨üá™', keywords: ['georgia', 'georgien', 'tbilisi', 'tiflis'] },
            'DEU': { name: 'Deutschland', code: 'DE', flag: 'üá©üá™', keywords: ['germany', 'deutschland', 'berlin', 'scholz', 'german', 'merz', 'bundesregierung'] },
            'GRC': { name: 'Griechenland', code: 'GR', flag: 'üá¨üá∑', keywords: ['greece', 'griechenland', 'athens', 'athen'] },
            'GRL': { name: 'Gr√∂nland', code: 'GL', flag: 'üá¨üá±', keywords: ['greenland', 'gr√∂nland', 'nuuk'] },
            'HUN': { name: 'Ungarn', code: 'HU', flag: 'üá≠üá∫', keywords: ['hungary', 'ungarn', 'budapest', 'orban'] },
            'ISL': { name: 'Island', code: 'IS', flag: 'üáÆüá∏', keywords: ['iceland', 'island', 'reykjavik'] },
            'IND': { name: 'Indien', code: 'IN', flag: 'üáÆüá≥', keywords: ['india', 'indien', 'delhi', 'mumbai', 'modi', 'indian'] },
            'IDN': { name: 'Indonesien', code: 'ID', flag: 'üáÆüá©', keywords: ['indonesia', 'indonesien', 'jakarta'] },
            'IRN': { name: 'Iran', code: 'IR', flag: 'üáÆüá∑', keywords: ['iran', 'tehran', 'teheran', 'iranian', 'persian'] },
            'IRQ': { name: 'Irak', code: 'IQ', flag: 'üáÆüá∂', keywords: ['iraq', 'irak', 'baghdad', 'bagdad'] },
            'IRL': { name: 'Irland', code: 'IE', flag: 'üáÆüá™', keywords: ['ireland', 'irland', 'dublin', 'irish'] },
            'ISR': { name: 'Israel', code: 'IL', flag: 'üáÆüá±', keywords: ['israel', 'jerusalem', 'tel aviv', 'netanyahu', 'israeli', 'gaza', 'hamas', 'idf', 'west bank'] },
            'ITA': { name: 'Italien', code: 'IT', flag: 'üáÆüáπ', keywords: ['italy', 'italien', 'rome', 'rom', 'milan', 'mailand', 'meloni', 'italian'] },
            'JPN': { name: 'Japan', code: 'JP', flag: 'üáØüáµ', keywords: ['japan', 'tokyo', 'tokio', 'japanese'] },
            'JOR': { name: 'Jordanien', code: 'JO', flag: 'üáØüá¥', keywords: ['jordan', 'jordanien', 'amman'] },
            'KAZ': { name: 'Kasachstan', code: 'KZ', flag: 'üá∞üáø', keywords: ['kazakhstan', 'kasachstan', 'astana'] },
            'KEN': { name: 'Kenia', code: 'KE', flag: 'üá∞üá™', keywords: ['kenya', 'kenia', 'nairobi'] },
            'PRK': { name: 'Nordkorea', code: 'KP', flag: 'üá∞üáµ', keywords: ['north korea', 'nordkorea', 'pyongyang', 'kim jong'] },
            'KOR': { name: 'S√ºdkorea', code: 'KR', flag: 'üá∞üá∑', keywords: ['south korea', 's√ºdkorea', 'seoul', 'korean'] },
            'KWT': { name: 'Kuwait', code: 'KW', flag: 'üá∞üáº', keywords: ['kuwait'] },
            'LVA': { name: 'Lettland', code: 'LV', flag: 'üá±üáª', keywords: ['latvia', 'lettland', 'riga'] },
            'LBN': { name: 'Libanon', code: 'LB', flag: 'üá±üáß', keywords: ['lebanon', 'libanon', 'beirut', 'hezbollah'] },
            'LBY': { name: 'Libyen', code: 'LY', flag: 'üá±üáæ', keywords: ['libya', 'libyen', 'tripoli'] },
            'LTU': { name: 'Litauen', code: 'LT', flag: 'üá±üáπ', keywords: ['lithuania', 'litauen', 'vilnius'] },
            'MYS': { name: 'Malaysia', code: 'MY', flag: 'üá≤üáæ', keywords: ['malaysia', 'kuala lumpur'] },
            'MEX': { name: 'Mexiko', code: 'MX', flag: 'üá≤üáΩ', keywords: ['mexico', 'mexiko', 'mexican'] },
            'MDA': { name: 'Moldau', code: 'MD', flag: 'üá≤üá©', keywords: ['moldova', 'moldau', 'chisinau'] },
            'MNG': { name: 'Mongolei', code: 'MN', flag: 'üá≤üá≥', keywords: ['mongolia', 'mongolei'] },
            'MAR': { name: 'Marokko', code: 'MA', flag: 'üá≤üá¶', keywords: ['morocco', 'marokko', 'rabat'] },
            'MMR': { name: 'Myanmar', code: 'MM', flag: 'üá≤üá≤', keywords: ['myanmar', 'burma', 'yangon'] },
            'NLD': { name: 'Niederlande', code: 'NL', flag: 'üá≥üá±', keywords: ['netherlands', 'niederlande', 'amsterdam', 'dutch', 'holland'] },
            'NZL': { name: 'Neuseeland', code: 'NZ', flag: 'üá≥üáø', keywords: ['new zealand', 'neuseeland', 'wellington'] },
            'NGA': { name: 'Nigeria', code: 'NG', flag: 'üá≥üá¨', keywords: ['nigeria', 'lagos', 'abuja'] },
            'NOR': { name: 'Norwegen', code: 'NO', flag: 'üá≥üá¥', keywords: ['norway', 'norwegen', 'oslo', 'norwegian'] },
            'PAK': { name: 'Pakistan', code: 'PK', flag: 'üáµüá∞', keywords: ['pakistan', 'islamabad', 'karachi'] },
            'PSE': { name: 'Pal√§stina', code: 'PS', flag: 'üáµüá∏', keywords: ['palestine', 'pal√§stina', 'palestinian', 'gaza', 'west bank', 'ramallah'] },
            'PAN': { name: 'Panama', code: 'PA', flag: 'üáµüá¶', keywords: ['panama'] },
            'PER': { name: 'Peru', code: 'PE', flag: 'üáµüá™', keywords: ['peru', 'lima'] },
            'PHL': { name: 'Philippinen', code: 'PH', flag: 'üáµüá≠', keywords: ['philippines', 'philippinen', 'manila'] },
            'POL': { name: 'Polen', code: 'PL', flag: 'üáµüá±', keywords: ['poland', 'polen', 'warsaw', 'warschau', 'polish'] },
            'PRT': { name: 'Portugal', code: 'PT', flag: 'üáµüáπ', keywords: ['portugal', 'lisbon', 'lissabon'] },
            'QAT': { name: 'Katar', code: 'QA', flag: 'üá∂üá¶', keywords: ['qatar', 'katar', 'doha'] },
            'ROU': { name: 'Rum√§nien', code: 'RO', flag: 'üá∑üá¥', keywords: ['romania', 'rum√§nien', 'bucharest', 'bukarest'] },
            'RUS': { name: 'Russland', code: 'RU', flag: 'üá∑üá∫', keywords: ['russia', 'russland', 'moscow', 'moskau', 'putin', 'kremlin', 'russian'] },
            'SAU': { name: 'Saudi-Arabien', code: 'SA', flag: 'üá∏üá¶', keywords: ['saudi', 'arabia', 'arabien', 'riyadh', 'riad', 'mbs'] },
            'SRB': { name: 'Serbien', code: 'RS', flag: 'üá∑üá∏', keywords: ['serbia', 'serbien', 'belgrade', 'belgrad'] },
            'SGP': { name: 'Singapur', code: 'SG', flag: 'üá∏üá¨', keywords: ['singapore', 'singapur'] },
            'SVK': { name: 'Slowakei', code: 'SK', flag: 'üá∏üá∞', keywords: ['slovakia', 'slowakei', 'bratislava'] },
            'SVN': { name: 'Slowenien', code: 'SI', flag: 'üá∏üáÆ', keywords: ['slovenia', 'slowenien', 'ljubljana'] },
            'ZAF': { name: 'S√ºdafrika', code: 'ZA', flag: 'üáøüá¶', keywords: ['south africa', 's√ºdafrika', 'johannesburg', 'pretoria'] },
            'ESP': { name: 'Spanien', code: 'ES', flag: 'üá™üá∏', keywords: ['spain', 'spanien', 'madrid', 'barcelona', 'spanish'] },
            'SDN': { name: 'Sudan', code: 'SD', flag: 'üá∏üá©', keywords: ['sudan', 'khartoum', 'khartum'] },
            'SWE': { name: 'Schweden', code: 'SE', flag: 'üá∏üá™', keywords: ['sweden', 'schweden', 'stockholm', 'swedish'] },
            'CHE': { name: 'Schweiz', code: 'CH', flag: 'üá®üá≠', keywords: ['switzerland', 'schweiz', 'bern', 'z√ºrich', 'geneva', 'genf', 'swiss'] },
            'SYR': { name: 'Syrien', code: 'SY', flag: 'üá∏üáæ', keywords: ['syria', 'syrien', 'damascus', 'damaskus', 'assad'] },
            'TWN': { name: 'Taiwan', code: 'TW', flag: 'üáπüáº', keywords: ['taiwan', 'taipei', 'taiwanese'] },
            'THA': { name: 'Thailand', code: 'TH', flag: 'üáπüá≠', keywords: ['thailand', 'bangkok'] },
            'TUN': { name: 'Tunesien', code: 'TN', flag: 'üáπüá≥', keywords: ['tunisia', 'tunesien', 'tunis'] },
            'TUR': { name: 'T√ºrkei', code: 'TR', flag: 'üáπüá∑', keywords: ['turkey', 't√ºrkei', 'ankara', 'istanbul', 'erdogan', 'turkish'] },
            'UKR': { name: 'Ukraine', code: 'UA', flag: 'üá∫üá¶', keywords: ['ukraine', 'kyiv', 'kiew', 'zelensky', 'ukrainian', 'crimea', 'krim', 'donbass'] },
            'ARE': { name: 'VAE', code: 'AE', flag: 'üá¶üá™', keywords: ['emirates', 'uae', 'vae', 'dubai', 'abu dhabi'] },
            'GBR': { name: 'Gro√übritannien', code: 'GB', flag: 'üá¨üáß', keywords: ['uk', 'britain', 'gro√übritannien', 'england', 'london', 'british', 'scotland', 'wales'] },
            'USA': { name: 'USA', code: 'US', flag: 'üá∫üá∏', keywords: ['usa', 'united states', 'america', 'washington', 'biden', 'trump', 'american', 'congress', 'white house', 'pentagon'] },
            'UZB': { name: 'Usbekistan', code: 'UZ', flag: 'üá∫üáø', keywords: ['uzbekistan', 'usbekistan', 'tashkent'] },
            'VEN': { name: 'Venezuela', code: 'VE', flag: 'üáªüá™', keywords: ['venezuela', 'caracas', 'maduro'] },
            'VNM': { name: 'Vietnam', code: 'VN', flag: 'üáªüá≥', keywords: ['vietnam', 'hanoi', 'vietnamese'] },
            'YEM': { name: 'Jemen', code: 'YE', flag: 'üáæüá™', keywords: ['yemen', 'jemen', 'sanaa', 'houthi'] }
        };

        // ============ NEWS SCRAPERS ============
        const newsScrapers = [
            { name: 'tagesschau', displayName: 'Tagesschau', url: 'https://www.tagesschau.de/xml/rss2/', category: 'Politik' },
            { name: 'zeit', displayName: 'Die Zeit', url: 'https://newsfeed.zeit.de/index', category: 'Politik' },
            { name: 'bild', displayName: 'BILD', url: 'https://www.bild.de/rssfeeds/rss3-20745882,feed=alles.bild.html', category: 'News' },
            { name: 'dw', displayName: 'Deutsche Welle', url: 'https://rss.dw.com/rdf/rss-de-all', category: 'Politik' },
            { name: 'cnn', displayName: 'CNN', url: 'http://rss.cnn.com/rss/edition_world.rss', category: 'Politik' },
            { name: 'nbc', displayName: 'NBC News', url: 'https://feeds.nbcnews.com/nbcnews/public/world', category: 'Politik' },
            { name: 'cbs', displayName: 'CBS News', url: 'https://www.cbsnews.com/latest/rss/world', category: 'Politik' },
            { name: 'wapo', displayName: 'Washington Post', url: 'https://feeds.washingtonpost.com/rss/world', category: 'Politik' },
            { name: 'npr', displayName: 'NPR', url: 'https://feeds.npr.org/1004/rss.xml', category: 'Politik' },
            { name: 'pbs', displayName: 'PBS', url: 'https://www.pbs.org/newshour/feeds/rss/world', category: 'Politik' },
            { name: 'bbc', displayName: 'BBC News', url: 'https://feeds.bbci.co.uk/news/world/rss.xml', category: 'Politik' },
            { name: 'france24', displayName: 'France 24', url: 'https://www.france24.com/en/rss', category: 'Politik' },
            { name: 'euronews', displayName: 'Euronews', url: 'https://www.euronews.com/rss?level=theme&name=news', category: 'Politik' },
            { name: 'nzz', displayName: 'NZZ', url: 'https://www.nzz.ch/international.rss', category: 'Politik' },
            { name: 'orf', displayName: 'ORF', url: 'https://rss.orf.at/news.xml', category: 'Politik' }
        ];

        let articles = [];
        let countryArticles = {}; // ISO3 -> [articles]
        let geojsonLayer = null;
        let map = null;
        let highlightedCountries = new Set();
        let selectedArticle = null;

        // ============ COUNTRY DETECTION ============
        function detectCountries(text) {
            const lowerText = text.toLowerCase();
            const detected = {};

            for (const [iso3, data] of Object.entries(countryNames)) {
                let score = 0;
                for (const keyword of data.keywords) {
                    const regex = new RegExp('\\b' + keyword + '\\b', 'gi');
                    const matches = lowerText.match(regex);
                    if (matches) {
                        score += matches.length;
                    }
                }
                if (score > 0) {
                    detected[iso3] = score;
                }
            }

            // Sort by score
            const sorted = Object.entries(detected).sort((a, b) => b[1] - a[1]);
            return sorted.map(([iso3, score]) => ({ iso3, score, ...countryNames[iso3] }));
        }

        // ============ FETCH WITH PROXY ============
        async function fetchWithProxy(url) {
            const proxies = [
                `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
                `https://corsproxy.io/?${encodeURIComponent(url)}`
            ];
            for (const proxyUrl of proxies) {
                try {
                    const r = await fetch(proxyUrl);
                    if (r.ok) return await r.text();
                } catch (e) { continue; }
            }
            throw new Error('Proxy failed');
        }

        // ============ PARSE RSS ============
        function parseRSS(xml, source) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(xml, 'text/xml');
            const items = doc.querySelectorAll('item');
            const results = [];
            const now = new Date();
            const oneDayAgo = new Date(now - 24 * 60 * 60 * 1000);

            items.forEach(item => {
                try {
                    const pubDateStr = item.querySelector('pubDate')?.textContent;
                    const pubDate = pubDateStr ? new Date(pubDateStr) : new Date();
                    if (pubDateStr && pubDate < oneDayAgo) return;

                    const title = item.querySelector('title')?.textContent?.replace(/<[^>]*>/g, '').trim() || '';
                    const link = item.querySelector('link')?.textContent?.trim() || '';
                    const description = item.querySelector('description')?.textContent?.replace(/<[^>]*>/g, '').trim() || '';

                    if (!title || !link) return;

                    // Detect countries
                    const fullText = title + ' ' + description;
                    const countries = detectCountries(fullText);

                    if (countries.length > 0) {
                        results.push({
                            id: 'art_' + Math.random().toString(36).substr(2, 9),
                            title,
                            url: link,
                            description: description.substring(0, 200),
                            source,
                            createdAt: pubDate,
                            countries, // Array of detected countries with scores
                            primaryCountry: countries[0]?.iso3 || null
                        });
                    }
                } catch (e) {}
            });

            return results;
        }

        // ============ SCRAPE ALL NEWS ============
        async function scrapeNews() {
            const statusEl = document.getElementById('loadingStatus');
            const fillEl = document.getElementById('loadingFill');
            
            articles = [];
            let completed = 0;

            for (const scraper of newsScrapers) {
                statusEl.textContent = `Lade ${scraper.displayName}...`;
                fillEl.style.width = ((completed / newsScrapers.length) * 100) + '%';

                try {
                    const xml = await Promise.race([
                        fetchWithProxy(scraper.url),
                        new Promise((_, r) => setTimeout(() => r(new Error('Timeout')), 10000))
                    ]);
                    const parsed = parseRSS(xml, scraper.displayName);
                    articles.push(...parsed);
                } catch (e) {
                    console.log(`${scraper.name} failed`);
                }

                completed++;
                await new Promise(r => setTimeout(r, 100));
            }

            // Remove duplicates
            const seen = new Set();
            articles = articles.filter(a => {
                if (seen.has(a.url)) return false;
                seen.add(a.url);
                return true;
            });

            // Sort by date
            articles.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

            // Group by country
            countryArticles = {};
            articles.forEach(article => {
                article.countries.forEach(country => {
                    if (!countryArticles[country.iso3]) {
                        countryArticles[country.iso3] = [];
                    }
                    countryArticles[country.iso3].push(article);
                });
            });

            fillEl.style.width = '100%';
            statusEl.textContent = `${articles.length} Artikel geladen!`;

            document.getElementById('totalArticles').textContent = articles.length;
            document.getElementById('totalCountries').textContent = Object.keys(countryArticles).length;
        }

        // ============ MAP ============
        function initMap() {
            map = L.map('map', {
                center: [30, 10],
                zoom: 2.5,
                minZoom: 2,
                maxZoom: 8,
                zoomControl: false,
                attributionControl: false
            });

            // Load GeoJSON
            fetch('https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson')
                .then(r => r.json())
                .then(data => {
                    geojsonLayer = L.geoJSON(data, {
                        style: feature => getCountryStyle(feature.properties.ISO_A3),
                        onEachFeature: (feature, layer) => {
                            layer.on({
                                mouseover: e => onCountryHover(e, feature),
                                mouseout: onCountryLeave,
                                click: e => onCountryClick(feature)
                            });
                        }
                    }).addTo(map);

                    updateMapColors();
                });
        }

        function getCountryStyle(iso3) {
            const count = countryArticles[iso3]?.length || 0;
            const isHighlighted = highlightedCountries.has(iso3);

            let fillColor = '#111';
            if (isHighlighted) {
                fillColor = '#ff6b6b';
            } else if (count > 20) {
                fillColor = '#74c69d';
            } else if (count > 10) {
                fillColor = '#52b788';
            } else if (count > 5) {
                fillColor = '#40916c';
            } else if (count > 2) {
                fillColor = '#2d6a4f';
            } else if (count > 0) {
                fillColor = '#1a472a';
            }

            return {
                fillColor,
                weight: isHighlighted ? 2 : 1,
                opacity: 1,
                color: isHighlighted ? '#ff6b6b' : '#222',
                fillOpacity: isHighlighted ? 0.8 : 0.7
            };
        }

        function updateMapColors() {
            if (!geojsonLayer) return;
            geojsonLayer.eachLayer(layer => {
                const iso3 = layer.feature.properties.ISO_A3;
                layer.setStyle(getCountryStyle(iso3));
            });
        }

        function onCountryHover(e, feature) {
            const iso3 = feature.properties.ISO_A3;
            const count = countryArticles[iso3]?.length || 0;
            const data = countryNames[iso3];

            if (count > 0 || highlightedCountries.has(iso3)) {
                const tooltip = document.getElementById('countryTooltip');
                tooltip.classList.add('show');
                document.getElementById('tooltipName').textContent = `${data?.flag || ''} ${data?.name || feature.properties.ADMIN}`;
                document.getElementById('tooltipCount').textContent = `${count} Artikel`;
                
                tooltip.style.left = (e.originalEvent.pageX + 15) + 'px';
                tooltip.style.top = (e.originalEvent.pageY + 15) + 'px';
            }

            e.target.setStyle({ weight: 2, color: '#fff' });
        }

        function onCountryLeave(e) {
            document.getElementById('countryTooltip').classList.remove('show');
            const iso3 = e.target.feature.properties.ISO_A3;
            e.target.setStyle(getCountryStyle(iso3));
        }

        function onCountryClick(feature) {
            const iso3 = feature.properties.ISO_A3;
            const countryData = countryNames[iso3];
            if (countryData && countryArticles[iso3]?.length > 0) {
                document.getElementById('searchInput').value = countryData.name;
                filterArticles(countryData.name);
            }
        }

        // ============ ARTICLE LIST ============
        function renderArticleList(filteredArticles = articles) {
            const list = document.getElementById('articleList');
            document.getElementById('filteredCount').textContent = filteredArticles.length;

            if (filteredArticles.length === 0) {
                list.innerHTML = '<div style="padding: 20px; text-align: center; color: #444;">Keine Artikel gefunden</div>';
                return;
            }

            list.innerHTML = filteredArticles.map(article => {
                const primaryCountry = article.countries[0];
                const otherCountries = article.countries.slice(1, 4);

                return `
                    <div class="article-item ${selectedArticle?.id === article.id ? 'active' : ''}" data-id="${article.id}">
                        <div class="article-item-source">
                            <span>${article.source}</span>
                            <span>${formatTime(article.createdAt)}</span>
                        </div>
                        <div class="article-item-title">${article.title}</div>
                        <div class="article-item-countries">
                            ${primaryCountry ? `<span class="article-item-country primary">${primaryCountry.flag} ${primaryCountry.name}</span>` : ''}
                            ${otherCountries.map(c => `<span class="article-item-country">${c.flag}</span>`).join('')}
                        </div>
                    </div>
                `;
            }).join('');

            // Add click handlers
            list.querySelectorAll('.article-item').forEach(item => {
                item.addEventListener('click', () => {
                    const article = articles.find(a => a.id === item.dataset.id);
                    if (article) showArticlePanel(article);
                });
            });
        }

        function showArticlePanel(article) {
            selectedArticle = article;
            
            // Highlight countries on map
            highlightedCountries = new Set(article.countries.map(c => c.iso3));
            updateMapColors();

            // Update panel
            const panel = document.getElementById('articlePanel');
            const content = document.getElementById('panelContent');

            const primaryCountry = article.countries[0];
            const allCountries = article.countries;

            content.innerHTML = `
                <div class="panel-source">
                    <div class="panel-source-icon">üì∞</div>
                    <div class="panel-source-info">
                        <div class="panel-source-name">${article.source}</div>
                        <div class="panel-source-time">${formatTime(article.createdAt)}</div>
                    </div>
                    <button class="panel-open-btn" onclick="window.open('${article.url}', '_blank')">√ñFFNEN ‚Üí</button>
                </div>
                <div class="panel-article-title">${article.title}</div>
                <div class="panel-countries">
                    <div class="panel-countries-label">ERW√ÑHNTE L√ÑNDER</div>
                    <div class="panel-countries-list">
                        ${allCountries.map((c, i) => `
                            <div class="panel-country-tag ${i === 0 ? 'primary' : ''}">
                                <span class="flag">${c.flag}</span>
                                ${c.name}
                                <span style="opacity: 0.5; font-size: 8px;">(${c.score}x)</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ${article.description ? `<p style="color: #888; font-size: 12px; line-height: 1.6; margin-top: 15px;">${article.description}...</p>` : ''}
            `;

            panel.classList.add('show');
            renderArticleList(); // Update active state

            // Zoom to primary country
            if (primaryCountry && geojsonLayer) {
                geojsonLayer.eachLayer(layer => {
                    if (layer.feature.properties.ISO_A3 === primaryCountry.iso3) {
                        map.fitBounds(layer.getBounds(), { padding: [100, 100], maxZoom: 5 });
                    }
                });
            }
        }

        function hideArticlePanel() {
            document.getElementById('articlePanel').classList.remove('show');
            selectedArticle = null;
            highlightedCountries.clear();
            updateMapColors();
            renderArticleList();
        }

        // ============ SEARCH / FILTER ============
        function filterArticles(term) {
            const lowerTerm = term.toLowerCase().trim();
            
            if (!lowerTerm) {
                highlightedCountries.clear();
                updateMapColors();
                renderArticleList(articles);
                return;
            }

            const filtered = articles.filter(article => {
                const titleMatch = article.title.toLowerCase().includes(lowerTerm);
                const sourceMatch = article.source.toLowerCase().includes(lowerTerm);
                const countryMatch = article.countries.some(c => 
                    c.name.toLowerCase().includes(lowerTerm) ||
                    c.keywords.some(kw => kw.includes(lowerTerm))
                );
                return titleMatch || sourceMatch || countryMatch;
            });

            // Highlight matching countries
            highlightedCountries.clear();
            for (const [iso3, data] of Object.entries(countryNames)) {
                if (data.name.toLowerCase().includes(lowerTerm) || 
                    data.keywords.some(kw => kw.includes(lowerTerm))) {
                    highlightedCountries.add(iso3);
                }
            }
            updateMapColors();

            renderArticleList(filtered);
        }

        // ============ HELPERS ============
        function formatTime(date) {
            if (!date) return '-';
            const d = date instanceof Date ? date : new Date(date);
            const now = new Date();
            const diff = Math.floor((now - d) / 1000 / 60);
            if (diff < 60) return `vor ${diff}m`;
            if (diff < 1440) return `vor ${Math.floor(diff / 60)}h`;
            return d.toLocaleDateString('de-DE');
        }

        function updateTime() {
            document.getElementById('currentTime').textContent = new Date().toLocaleTimeString('de-DE');
        }
        setInterval(updateTime, 1000);
        updateTime();

        // ============ EVENT LISTENERS ============
        document.getElementById('sidebarToggle').addEventListener('click', () => {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('collapsed');
            document.getElementById('sidebarToggle').textContent = sidebar.classList.contains('collapsed') ? '‚ñ∂' : '‚óÄ';
        });

        document.getElementById('panelClose').addEventListener('click', hideArticlePanel);

        document.getElementById('searchInput').addEventListener('input', (e) => {
            filterArticles(e.target.value);
        });

        // ============ INIT ============
        async function init() {
            initMap();
            await scrapeNews();
            
            setTimeout(() => {
                document.getElementById('loadingOverlay').classList.add('hidden');
                renderArticleList();
            }, 500);
        }

        init();
    </script>
</body>
</html>
